# üì± Phone Number Validation Guide

–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ E.164.

## üåç **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç E.164**

### **‚úÖ –ß—Ç–æ —Ç–∞–∫–æ–µ E.164:**

**E.164** - —ç—Ç–æ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
- **Telegram Gateway API** - —Ç—Ä–µ–±—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç E.164
- **Green SMS API** - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç E.164
- **–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### **üìã –§–æ—Ä–º–∞—Ç E.164:**

```
+[–∫–æ–¥ —Å—Ç—Ä–∞–Ω—ã][–Ω–æ–º–µ—Ä]
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `+`
- –ö–æ–¥ —Å—Ç—Ä–∞–Ω—ã: 1-3 —Ü–∏—Ñ—Ä—ã
- –ù–æ–º–µ—Ä: 6-14 —Ü–∏—Ñ—Ä
- –û–±—â–∞—è –¥–ª–∏–Ω–∞: 7-15 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ `+`

## üîß **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç–µ**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:**

```python
# –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
"8 912 345 67 89" ‚Üí "+79123456789"
"7 912 345 67 89" ‚Üí "+79123456789"  
"79123456789" ‚Üí "+79123456789"
"+79123456789" ‚Üí "+79123456789"
"8-912-345-67-89" ‚Üí "+79123456789"
```

### **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤–≤–æ–¥–∞:**

```python
# –†–æ—Å—Å–∏—è
"+79123456789"     # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
"79123456789"      # ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç +79123456789
"8 912 345 67 89"  # ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç +79123456789
"8-912-345-67-89"  # ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç +79123456789

# –°–®–ê/–ö–∞–Ω–∞–¥–∞
"+1234567890"      # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
"1234567890"       # ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç +1234567890

# –£–∫—Ä–∞–∏–Ω–∞
"+380123456789"    # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
"380123456789"     # ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç +380123456789
```

## üõ†Ô∏è **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤**

### **–ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**

```python
from authentication.validators import validate_phone_number, normalize_phone_number

# –í–∞–ª–∏–¥–∞—Ü–∏—è
try:
    validate_phone_number("+79123456789")
    print("–ù–æ–º–µ—Ä –≤–∞–ª–∏–¥–µ–Ω")
except ValidationError as e:
    print(f"–û—à–∏–±–∫–∞: {e}")

# –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
normalized = normalize_phone_number("8 912 345 67 89")
print(normalized)  # "+79123456789"
```

### **–í —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞—Ö:**

```python
class PhoneVerificationSerializer(serializers.Serializer):
    phone = serializers.CharField(max_length=20)
    
    def validate_phone(self, value):
        try:
            return normalize_phone_number(value)
        except Exception as e:
            raise serializers.ValidationError(f"–û—à–∏–±–∫–∞: {e}")
```

## üìä **–ü—Ä–∏–º–µ—Ä—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

### **‚úÖ –í–∞–ª–∏–¥–Ω—ã–µ –Ω–æ–º–µ—Ä–∞:**

```python
# –†–æ—Å—Å–∏—è
"+79123456789"     # 11 —Ü–∏—Ñ—Ä
"+7912345678"       # 10 —Ü–∏—Ñ—Ä
"+791234567890"     # 12 —Ü–∏—Ñ—Ä

# –°–®–ê/–ö–∞–Ω–∞–¥–∞
"+1234567890"       # 10 —Ü–∏—Ñ—Ä
"+12345678901"      # 11 —Ü–∏—Ñ—Ä

# –£–∫—Ä–∞–∏–Ω–∞
"+380123456789"     # 12 —Ü–∏—Ñ—Ä

# –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã
"+8612345678901"    # –ö–∏—Ç–∞–π
"+81123456789"      # –Ø–ø–æ–Ω–∏—è
```

### **‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –Ω–æ–º–µ—Ä–∞:**

```python
# –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã
"79123456789"       # –ù–µ—Ç +
"+791234567"        # –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
"+791234567890123"  # –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
"+079123456789"     # –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0
"+79123456789a"     # –°–æ–¥–µ—Ä–∂–∏—Ç –±—É–∫–≤—ã
"79123456789+"      # + –Ω–µ –≤ –Ω–∞—á–∞–ª–µ
```

## üéØ **API Endpoints**

### **–û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞:**

```http
POST /api/auth/send-code/
Content-Type: application/json

{
    "phone": "+79123456789"  # E.164 —Ñ–æ—Ä–º–∞—Ç
}

# –ò–ª–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π:
{
    "phone": "8 912 345 67 89"  # –ë—É–¥–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω –¥–æ +79123456789
}
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:**

```http
POST /api/auth/verify-code/
Content-Type: application/json

{
    "phone": "+79123456789",
    "code": "123456"
}
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Telegram:**

```http
GET /api/auth/check-telegram/?phone=+79123456789

# –û—Ç–≤–µ—Ç:
{
    "telegram_available": true,
    "phone": "+79123456789"
}
```

## üîç **–î–µ—Ç–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã:**

```python
from authentication.validators import get_country_code

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã
country_code = get_country_code("+79123456789")
print(country_code)  # "7" (–†–æ—Å—Å–∏—è)

country_code = get_country_code("+1234567890")
print(country_code)  # "1" (–°–®–ê/–ö–∞–Ω–∞–¥–∞)
```

### **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**

```python
from authentication.validators import format_phone_display

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è UI
formatted = format_phone_display("+79123456789")
print(formatted)  # "+7 (912) 345-67-89"

formatted = format_phone_display("+1234567890")
print(formatted)  # "+1 (234) 567-890"
```

## üö® **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

### **–¢–∏–ø—ã –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```python
# 1. –ü—É—Å—Ç–æ–π –Ω–æ–º–µ—Ä
{
    "phone": ["–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"]
}

# 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
{
    "phone": ["–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ E.164 (–Ω–∞–ø—Ä–∏–º–µ—Ä: +1234567890, +79123456789)"]
}

# 3. –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
{
    "phone": ["–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 7 –¥–æ 15 —Ü–∏—Ñ—Ä"]
}

# 4. –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π
{
    "phone": ["–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Ç 7 –¥–æ 15 —Ü–∏—Ñ—Ä"]
}

# 5. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0
{
    "phone": ["–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ E.164"]
}
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫:**

```python
# –í views.py
try:
    serializer = PhoneVerificationSerializer(data=request.data)
    if serializer.is_valid():
        phone = serializer.validated_data['phone']  # –£–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω
        # ... –æ–±—Ä–∞–±–æ—Ç–∫–∞
    else:
        return Response(serializer.errors, status=400)
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞: {e}")
    return Response({'error': '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏'}, status=500)
```

## üåê **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–∞–Ω**

### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–¥—ã —Å—Ç—Ä–∞–Ω:**

```python
# –°–ù–ì –∏ –í–æ—Å—Ç–æ—á–Ω–∞—è –ï–≤—Ä–æ–ø–∞
"+7"    # –†–æ—Å—Å–∏—è, –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
"+380"  # –£–∫—Ä–∞–∏–Ω–∞
"+375"  # –ë–µ–ª–∞—Ä—É—Å—å
"+998"  # –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω
"+996"  # –ö—ã—Ä–≥—ã–∑—Å—Ç–∞–Ω
"+992"  # –¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω
"+993"  # –¢—É—Ä–∫–º–µ–Ω–∏—Å—Ç–∞–Ω
"+374"  # –ê—Ä–º–µ–Ω–∏—è
"+995"  # –ì—Ä—É–∑–∏—è
"+994"  # –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω

# –ó–∞–ø–∞–¥–Ω–∞—è –ï–≤—Ä–æ–ø–∞
"+44"   # –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è
"+49"   # –ì–µ—Ä–º–∞–Ω–∏—è
"+33"   # –§—Ä–∞–Ω—Ü–∏—è
"+39"   # –ò—Ç–∞–ª–∏—è
"+34"   # –ò—Å–ø–∞–Ω–∏—è

# –°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞
"+1"    # –°–®–ê, –ö–∞–Ω–∞–¥–∞

# –ê–∑–∏—è
"+86"   # –ö–∏—Ç–∞–π
"+81"   # –Ø–ø–æ–Ω–∏—è
"+82"   # –Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è
"+91"   # –ò–Ω–¥–∏—è
"+90"   # –¢—É—Ä—Ü–∏—è
```

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤**

### **–†–æ—Å—Å–∏–π—Å–∫–∏–µ –Ω–æ–º–µ—Ä–∞:**

```python
# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
"8 912 345 67 89"    # ‚Üí +79123456789
"7 912 345 67 89"    # ‚Üí +79123456789
"+7 912 345 67 89"   # ‚Üí +79123456789
"8-912-345-67-89"    # ‚Üí +79123456789
"8(912)345-67-89"    # ‚Üí +79123456789
```

### **–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏–µ –Ω–æ–º–µ—Ä–∞:**

```python
# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
"1234567890"         # ‚Üí +1234567890
"+1 234 567 890"     # ‚Üí +1234567890
"1-234-567-890"      # ‚Üí +1234567890
```

## üìà **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```python
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
from django.core.cache import cache

def validate_phone_cached(phone):
    cache_key = f"phone_validation_{phone}"
    result = cache.get(cache_key)
    
    if result is None:
        result = validate_phone_number(phone)
        cache.set(cache_key, result, 3600)  # 1 —á–∞—Å
    
    return result
```

### **Batch –≤–∞–ª–∏–¥–∞—Ü–∏—è:**

```python
# –í–∞–ª–∏–¥–∞—Ü–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –Ω–æ–º–µ—Ä–æ–≤
def validate_phones_batch(phones):
    results = []
    for phone in phones:
        try:
            normalized = normalize_phone_number(phone)
            results.append({'phone': phone, 'normalized': normalized, 'valid': True})
        except Exception as e:
            results.append({'phone': phone, 'error': str(e), 'valid': False})
    return results
```

## üÜò **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º**

### **–ü—Ä–æ–±–ª–µ–º–∞: –ù–æ–º–µ—Ä –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è**

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—à–∞–≥–æ–≤–æ
phone = "8 912 345 67 89"

# 1. –û—á–∏—Å—Ç–∫–∞
cleaned = re.sub(r'[\s\-\(\)]', '', phone)
print(f"–û—á–∏—â–µ–Ω–Ω—ã–π: {cleaned}")  # "89123456789"

# 2. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
if cleaned.startswith('8') and len(cleaned) == 11:
    normalized = '+7' + cleaned[1:]
    print(f"–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π: {normalized}")  # "+79123456789"

# 3. –í–∞–ª–∏–¥–∞—Ü–∏—è
validate_phone_number(normalized)
```

### **–ü—Ä–æ–±–ª–µ–º–∞: API –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–æ–º–µ—Ä**

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–ª—è API
def check_api_format(phone):
    # Telegram Gateway —Ç—Ä–µ–±—É–µ—Ç E.164
    if not phone.startswith('+'):
        return False
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
    digits = phone[1:]
    if len(digits) < 7 or len(digits) > 15:
        return False
    
    return True
```

## üìö **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã**

- [E.164 —Å—Ç–∞–Ω–¥–∞—Ä—Ç](https://en.wikipedia.org/wiki/E.164)
- [Telegram Gateway API](https://gatewayapi.telegram.org/)
- [Django –≤–∞–ª–∏–¥–∞—Ü–∏—è](https://docs.djangoproject.com/en/stable/ref/validators/)
- [Python regex](https://docs.python.org/3/library/re.html)

---

**–¢–µ–ø–µ—Ä—å –≤–∞—à–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –ø–æ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–º—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É E.164! üåçüì±**
